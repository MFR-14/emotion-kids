<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GESYA - Cara Bermain</title>
  <link rel="stylesheet" href="./css/menu.css?v=5">
</head>

<body class="home">

  <!-- =========================
       OVERLAY: PIN -> INTRO -> MENU
       ========================= -->
  <div id="gateOverlay" class="gate-overlay">

    <!-- STEP 1: PIN -->
    <div id="pinStep" class="gate-card">
      <h2 class="gate-title">ğŸ” Akses GESYA</h2>
      <p class="gate-desc">Masukkan PIN dari guru / admin</p>

      <input
        id="pinInput"
        class="gate-input"
        type="password"
        inputmode="numeric"
        placeholder="â€¢â€¢â€¢â€¢"
        autocomplete="off"
      />

      <button id="btnPin" class="gate-btn" type="button">Masuk</button>

      <p id="pinError" class="gate-error">PIN salah. Coba lagi ya ğŸ™‚</p>

      <div class="gate-footer">Tips: kalau sudah masuk, PIN tidak diminta lagi di perangkat ini.</div>
    </div>

    <!-- STEP 2: INTRO (muncul setelah PIN benar) -->
    <div id="introStep" class="gate-card gate-intro" style="display:none;">
      <div class="intro-badge">ğŸ’ Untuk Anak SD</div>

      <h2 class="gate-title" style="margin-top:8px;">Selamat datang di GESYA! ğŸŒŸ</h2>

      <p class="intro-text">
        Game GESYA ini ditujukan bagi anak dengan disleksia usia <b>9â€“12 tahun</b> sebagai media pembelajaran untuk membantu anak mengenali emosi yang mereka rasakan serta melatih keterampilan mengelola emosi secara tepat dalam kehidupan sehari-hari.
      </p>

      <div class="intro-tip">
        Siap? Yuk lanjut ke menu dan mulai petualangannya! ğŸ˜„
      </div>

      <button id="btnLanjut" class="gate-btn gate-btn-primary" type="button">
        Lanjut ke Menu ğŸš€
      </button>

      <div class="intro-mini">
        Kamu bisa main pelan-pelan ya. Yang penting paham ğŸ˜Š
      </div>
    </div>

  </div>

  <main class="wrap">

    <!-- GAMBAR ATAS -->
    <section class="hero">
      <img src="./img/12.jpg" class="mascot" alt="Maskot GESYA">
      <div class="hero-title">
        <h1>Cara Bermain Game GESYA</h1>
        <p>Yuk main sambil belajar mengenali emosi ğŸ˜Š</p>
      </div>
    </section>

    <!-- PERATURAN -->
    <section class="card rules-card">
      <h2>Aturannya Mudah!</h2>
      <ul class="rules">
        <li>âœ… Cocokkan emosi sesuai level yang tersedia</li>
        <li>âœ… Klik atau geser jawaban sesuai pertanyaan</li>
        <li>âœ… Main sesuai waktu yang disediakan</li>
        <li>âœ… Setiap level ada nilai bintang â­</li>
        <li>âœ… Selesaikan semua level untuk dapat lencana <b>Ahli Emosi GESYA</b></li>
      </ul>
    </section>

    <!-- LEVEL -->
    <section class="card level-card">
      <h2>Pilih Level</h2>

      <div class="levels">
        <button class="lvl" onclick="goLevel(1)">
          <span class="no">1</span>
          <span class="txt">Level 1<br><small>Kenali Emosi</small></span>
          <span class="emo">ğŸ¯</span>
        </button>

        <button class="lvl" onclick="goLevel(2)">
          <span class="no">2</span>
          <span class="txt">Level 2<br><small>Pasangkan</small></span>
          <span class="emo">ğŸ§©</span>
        </button>

        <button class="lvl" onclick="goLevel(3)">
          <span class="no">3</span>
          <span class="txt">Level 3<br><small>Tempel Wajah</small></span>
          <span class="emo">ğŸ™‚</span>
        </button>

        <button class="lvl" onclick="goLevel(4)">
          <span class="no">4</span>
          <span class="txt">Level 4<br><small>Perasaanku</small></span>
          <span class="emo">ğŸ˜</span>
        </button>

        <button class="lvl" onclick="goLevel(5)">
          <span class="no">5</span>
          <span class="txt">Level 5<br><small>Aku Pilih Apa?</small></span>
          <span class="emo">ğŸ™‹â€â™‚ï¸</span>
        </button>

        <button class="lvl" onclick="goLevel(6)">
          <span class="no">6</span>
          <span class="txt">Level 6<br><small>Situasi</small></span>
          <span class="emo">ğŸ”¥</span>
        </button>

        <!-- MENU SERTIFIKAT (TERKUNCI SAMPAI 6 LEVEL SELESAI) -->
        <button class="lvl" id="btnReward" onclick="goReward()" disabled style="opacity:.55">
          <span class="no">ğŸ…</span>
          <span class="txt">Pencapaian<br><small>Sertifikat</small></span>
          <span class="emo">ğŸ“œ</span>
        </button>
      </div>

      <div class="bottom-note" id="progressNote">Tips: isi nama, umur, dan sekolah di Level 1 dulu ya âœ¨</div>

      <button class="reset" id="btnReset" type="button">Reset Data</button>
    </section>

  </main>

  <script>
    // =====================
    // KONFIG PIN
    // =====================
    const PIN_BENAR = "2025"; // â¬…ï¸ GANTI PIN DI SINI
    const KEY_UNLOCK = "gesya_unlocked";
    const KEY_INTRO_SHOWN = "gesya_intro_shown";

    const gateOverlay = document.getElementById("gateOverlay");
    const pinStep = document.getElementById("pinStep");
    const introStep = document.getElementById("introStep");

    const input = document.getElementById("pinInput");
    const btnPin = document.getElementById("btnPin");
    const err = document.getElementById("pinError");

    const btnLanjut = document.getElementById("btnLanjut");

    function showPin(){
      pinStep.style.display = "block";
      introStep.style.display = "none";
      gateOverlay.style.display = "flex";
      setTimeout(()=> input && input.focus(), 150);
    }

    function showIntro(){
      pinStep.style.display = "none";
      introStep.style.display = "block";
      gateOverlay.style.display = "flex";
    }

    function hideGate(){
      gateOverlay.style.display = "none";
    }

    function cekPin(){
      const val = (input.value || "").trim();
      if (val === PIN_BENAR) {
        err.style.display = "none";
        localStorage.setItem(KEY_UNLOCK, "1");     // ingat perangkat ini sudah lolos
        localStorage.removeItem(KEY_INTRO_SHOWN);  // pastikan intro muncul setelah PIN benar
        showIntro();
      } else {
        err.style.display = "block";
        input.value = "";
        input.focus();
      }
    }

    btnPin.addEventListener("click", cekPin);
    input.addEventListener("keydown", (e)=>{
      if (e.key === "Enter") cekPin();
    });

    btnLanjut.addEventListener("click", ()=>{
      localStorage.setItem(KEY_INTRO_SHOWN, "1");
      hideGate();
    });

    // =====================
    // LOGIKA GATE SAAT LOAD
    // =====================
    const unlocked = localStorage.getItem(KEY_UNLOCK) === "1";
    const introShown = localStorage.getItem(KEY_INTRO_SHOWN) === "1";

    if (!unlocked) {
      showPin();           // belum pernah lolos -> minta PIN
    } else if (!introShown) {
      showIntro();         // sudah lolos, tapi intro belum ditutup -> tampilkan intro
    } else {
      hideGate();          // sudah beres semua -> langsung menu
    }

    // =====================
    // MENU GAME
    // =====================
    function goLevel(lvl){
      if (lvl >= 7) {
        alert("Level ini masih dikunci ya ğŸ˜„");
        return;
      }
      window.location.href = `level${lvl}.html`;
    }

    function isAllLevelDone(){
      for (let i = 1; i <= 6; i++){
        const done = localStorage.getItem(`ek_level${i}_selesai`);
        if (done !== "1") return false;
      }
      return true;
    }

    function goReward(){
      if (!isAllLevelDone()){
        alert("Selesaikan dulu sampai Level 6 ya, baru sertifikatnya kebuka ğŸ˜");
        return;
      }
      window.location.href = "reward.html";
    }

    // ======= PROGRES / IDENTITAS =======
    const s1 = parseInt(localStorage.getItem("ek_level1_skor") || "0", 10);
    const s2 = parseInt(localStorage.getItem("ek_level2_skor") || "0", 10);
    const s3 = parseInt(localStorage.getItem("ek_level3_skor") || "0", 10);
    const s4 = parseInt(localStorage.getItem("ek_level4_skor") || "0", 10);
    const s5 = parseInt(localStorage.getItem("ek_level5_skor") || "0", 10);
    const s6 = parseInt(localStorage.getItem("ek_level6_skor") || "0", 10);
    const total = s1 + s2 + s3 + s4 + s5 + s6;

    const nama = (localStorage.getItem("ek_nama") || "").trim();
    const umur = (localStorage.getItem("ek_umur") || "").trim();
    const sekolah = (localStorage.getItem("ek_sekolah") || "").trim();

    const note = document.getElementById("progressNote");

    if (nama || umur || sekolah || total) {
      const namaTampil = nama ? nama.toUpperCase() : "TEMAN";
      const umurTampil = umur ? `${umur} tahun` : "-";
      const sekolahTampil = sekolah || "-";
      note.textContent = `Halo ${namaTampil}! Umur ${umurTampil} â€¢ Sekolah ${sekolahTampil} â€¢ Skor sementara ${total} â­`;
    }

    // AKTIFKAN TOMBOL SERTIFIKAT KALAU SUDAH SELESAI LEVEL 1-6
    const btnReward = document.getElementById("btnReward");
    if (btnReward){
      if (isAllLevelDone()){
        btnReward.disabled = false;
        btnReward.style.opacity = "1";
      } else {
        btnReward.disabled = true;
        btnReward.style.opacity = ".55";
      }
    }

    // ======= RESET =======
    document.getElementById("btnReset").addEventListener("click", ()=>{
      if (!confirm("Reset nama, umur, sekolah, dan semua skor?")) return;

      localStorage.removeItem("ek_nama");
      localStorage.removeItem("ek_umur");
      localStorage.removeItem("ek_sekolah");

      const keys = [
        "ek_level1_skor","ek_level2_skor","ek_level3_skor","ek_level4_skor","ek_level5_skor","ek_level6_skor",
        "ek_level1_selesai","ek_level2_selesai","ek_level3_selesai","ek_level4_selesai","ek_level5_selesai","ek_level6_selesai",
        "ek_level1_alasan","ek_level2_alasan","ek_level3_alasan","ek_level4_alasan","ek_level5_alasan","ek_level6_alasan"
      ];
      keys.forEach(k => localStorage.removeItem(k));

      // reset akses + intro
      localStorage.removeItem(KEY_UNLOCK);
      localStorage.removeItem(KEY_INTRO_SHOWN);

      location.reload();
    });
  </script>

</body>
</html>
